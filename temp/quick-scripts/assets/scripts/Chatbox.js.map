{"version":3,"sources":["Chatbox.js"],"names":["game","require","cc","Class","extends","Component","properties","catAvatarPrefab","default","type","Prefab","remAvatarPrefab","hulkAvatarPrefab","onLoad","timer","timeInterval","script","labelNode","Node","that","scene","curScript","loader","loadRes","err","res","json","console","log","updateDialog","length","node","destroy","Figure","showRemAvatar","showCatAvatar","showHulkAvatar","label","addComponent","Label","string","Script","fontSize","lineHeight","horizontalalign","overflow","width","color","Color","dX","x","dY","y","height","position","v2","parent","clearAvatar","hulkAvatar","instantiate","addChild","newX","newY","setPosition","catAvatar","remAvatar","removeAllChildren","start","update","dt"],"mappings":"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","file":"Chatbox.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar game  = require(\"Game\");\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        catAvatarPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        remAvatarPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        hulkAvatarPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.timer = 0;\r\n        this.timeInterval = 3;\r\n        this.script;\r\n        this.labelNode = new cc.Node(\"node\");\r\n        var that = this;\r\n        if(game.scene == 0){\r\n            game.scene = 1;\r\n            game.curScript = 0;\r\n            cc.loader.loadRes(\"startScene\", function (err, res) {\r\n                that.script = res.json;\r\n                console.log(that.script);\r\n                that.updateDialog();\r\n            });\r\n        }\r\n        else{\r\n            game.curScript = 0;\r\n            cc.loader.loadRes(\"endScene\", function (err, res) {\r\n                that.script = res.json;\r\n                console.log(that.script);\r\n                that.updateDialog();\r\n            });     \r\n        }\r\n    },\r\n\r\n    updateDialog(){\r\n        console.log(game.curScript);\r\n        console.log(this.script.length);\r\n        if(game.curScript >= this.script.length){\r\n            this.node.destroy();\r\n            return;\r\n        }\r\n        var curScript = this.script[game.curScript];\r\n        if(curScript.Figure == \"Rem\"){\r\n            this.showRemAvatar();\r\n        }\r\n        else if(curScript.Figure == \"Cat\" || curScript.Figure == \"???\"){\r\n            this.showCatAvatar();\r\n        }\r\n        else{\r\n            this.showHulkAvatar();\r\n        }\r\n\r\n        var label= this.labelNode.addComponent(cc.Label);\r\n        label.string=this.script[game.curScript].Script;\r\n        label.fontSize = 16;\r\n        label.lineHeight = 20;\r\n        label.horizontalalign = \"LEFT\";\r\n        label.overflow = \"RESIZE_HEIGHT\";\r\n        label.width = 380;\r\n\r\n        var color=new cc.Color(0,0,0);\r\n        var dX = this.node.x;\r\n        var dY = this.node.y + this.node.height - 35;\r\n        this.labelNode.width = 380;\r\n        this.labelNode.height = 200;\r\n        this.labelNode.position=cc.v2(dX,dY - this.labelNode.height/2 + 20);\r\n        this.labelNode.color=color;\r\n        this.labelNode.parent = this.node;\r\n    },\r\n\r\n    showHulkAvatar(){\r\n        this.clearAvatar();\r\n        var hulkAvatar = cc.instantiate(this.hulkAvatarPrefab);\r\n        this.node.addChild(hulkAvatar);\r\n        var newX = this.node.x - this.node.width/2 + hulkAvatar.width - 8;\r\n        var newY = this.node.y + this.node.height + hulkAvatar.height/2 - 2;\r\n        hulkAvatar.setPosition(cc.v2(newX, newY)); \r\n    },\r\n\r\n    showCatAvatar(){\r\n        this.clearAvatar();\r\n        var catAvatar = cc.instantiate(this.catAvatarPrefab);\r\n        this.node.addChild(catAvatar);\r\n        var newX = this.node.x - this.node.width/2 + catAvatar.width - 8;\r\n        var newY = this.node.y + this.node.height + catAvatar.height/2 - 2;\r\n        catAvatar.setPosition(cc.v2(newX, newY)); \r\n    },\r\n\r\n    showRemAvatar(){\r\n        this.clearAvatar();\r\n        var remAvatar = cc.instantiate(this.remAvatarPrefab);\r\n        this.node.addChild(remAvatar);\r\n        var newX = this.node.x - this.node.width/2 + remAvatar.width - 9;\r\n        var newY = this.node.y + this.node.height + remAvatar.height/2 - 2;\r\n        remAvatar.setPosition(cc.v2(newX, newY)); \r\n    },\r\n\r\n    clearAvatar(){\r\n        this.node.removeAllChildren();\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        if(this.timer >= this.timeInterval){\r\n                this.timer = 0;\r\n                game.curScript++;\r\n                this.updateDialog();\r\n        }\r\n        this.timer += dt;\r\n    },\r\n});\r\n"]}